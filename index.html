<!DOCTYPE html>
<html>
    <head>
        <title>Mapbox API test</title>
        <meta charset="utf-8">
        <link rel="stylesheet" type="text/css" href="css/default.css">
        <script src="https://api.tiles.mapbox.com/mapbox.js/v1.6.4/mapbox.js"></script>
        <link href="https://api.tiles.mapbox.com/mapbox.js/v1.6.4/mapbox.css" rel="stylesheet" />
        <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    </head>
    <body>
        <div id="map"></div>
        <script src="data/hospitals.js"></script>
        <script src="data/urban_areas.js"></script>
        <script src="js/functions.js"></script>
        <script>
            d3.select("#map")
              .style("height", window.innerHeight+"px");
            var map = L.mapbox.map('map', 'clementp.ipg3giee')
                              .setView([42.2, -71.7], 9);
            
            //We display the urban areas
            var urbanAreaFeature = L.geoJson(urbanAreaData, {
                style: {
                    fill: true,
                    fillColor: '#fff',
                    fillOpacity: 0,
                    stroke: true,
                    weight: 1,
                    color: '#000',
                    opacity: .1
                },
                onEachFeature: onEachFeature
            })
            .addTo(map);
            
            //We display the hospitals' markers
            map._initPathRoot();
            var markers = d3.select("#map svg")
              .append("g")
              .attr("class", "markers")
              .selectAll("image")
              .data(hospitalsData)
              .enter()
              .append("image")
              .attr("class", "marker")
              .attr("xlink:href", "icons/hospital.svg")
              .on("mouseover", function(d) {
                  displayPopup(d);
              });
//              .on("click", function(d) {
//                  topCommunityFromHospital(d);
//              });
            

            map.on("viewreset", updateMarkers);
            updateMarkers();
            
            d3.select(document)
              .on("ready", function() { 
                window.onresize = function(event) {
                    update();
                };
            });
        </script>
    </body>
</html>